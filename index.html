<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

<script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://npmcdn.com/chart.js@latest/dist/Chart.bundle.min.js"></script>
<script src="https://npmcdn.com/Chart.Zoom.js@latest/Chart.Zoom.min.js"></script>


<h1 id="price" style="text-align: center;"></h1>
<canvas id="myChart" width="800" height="200" style="max-width: 1600px; max-height:400px; margin: 0 auto;"></canvas>

<script>
    $.ajax("http://exwd.csie.org:3333/eth-realtime")
        .done(function(data) {
            try {
                data = JSON.parse(data);
            }
            catch (err) { }
            $('#price')[0].innerHTML = '<div style="color:red">買價:'+ (data.raw_buy_price / 100000)+'</div> <div style="color:green">賣價: '+(data.raw_sell_price / 100000)+'</div><div style="color:blue">差價: '+((data.raw_buy_price - data.raw_sell_price) / 100000)+'</div>';
        });
</script>
<script>
    var ctx = document.getElementById("myChart");

    $.ajax('./history.json').done(function (raw) {
        try {
            raw = JSON.parse(raw)
        }
        catch (err) { }

        var time = raw.map(item => item.time);
        var buy = raw.map(item => item.buy / 100000);
        var sell = raw.map(item => item.sell / 100000);


        var data = {
            labels: time,
            datasets: [{
                label: "Buy",
                fill: true,
                data: buy,
                backgroundColor: "rgba(200,0,0,0.1)",
                borderColor: "rgba(200,0,0,1)",
            }, {
                label: "Sell",
                fill: true,
                data: sell,
                backgroundColor: "rgba(0,200,0,0.3)",
                borderColor: "rgba(0,200,0,1)",
            }]
        };

        var myLineChart = new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                maintainAspectRatio: false,
                responsive: true,
                pan: {
                    enabled: true,
                    mode: 'x'
                },
                zoom: {
                    enabled: true,
                    mode: 'x',
                },
                hover: {
                    mode: 'label'
                },
                tooltips: {
                    mode: 'index',
                    intersect: false
                },
                scales: {
                    xAxes: [{
                        type: 'time',
                        time: {
                            minUnit: 'hour'
                        }
                    }]
                },
            }
        });
    });

</script>
